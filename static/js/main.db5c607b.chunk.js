(this["webpackJsonpmuse-react"]=this["webpackJsonpmuse-react"]||[]).push([[0],{13:function(t,i,e){},14:function(t,i,e){},15:function(t,i,e){"use strict";e.r(i);var n=e(0),a=e.n(n),o=e(5),s=e.n(o),r=(e(13),e(1)),h=e(2),m=e(7),c=e(6),d=(e(14),function t(){Object(r.a)(this,t),this.noteHeight=22,this.noteWidth=11,this.noteFontSize=22,this.noteFontFamily="serif",this.sigFontSize=14,this.trackGap=10,this.lineGap=20,this.pointGap=5,this.tailPointGap=8,this.pointRound=1.5,this.pageE=1.414,this.notationWidth=1e3,this.pageMarginHorizontal=100,this.pageMarginVertical=110,this.infoTitleFontSize=34,this.infoSubtitleFontSize=22,this.infoGap=7,this.infoFontSize=20,this.pageIndexFontSize=20,this.textFontFamily="serif"}),f=function(){function t(){Object(r.a)(this,t),this.x=void 0,this.y=void 0,this.width=void 0,this.height=void 0,this.marginTop=void 0,this.marginBottom=void 0,this.marginLeft=void 0,this.marginRight=void 0,this.x=0,this.y=0,this.width=0,this.height=0,this.marginBottom=0,this.marginTop=0,this.marginLeft=0,this.marginRight=0}return Object(h.a)(t,[{key:"init",value:function(t,i,e,n,a,o){this.x=t,this.y=i,this.width=e,this.height=n,this.marginBottom=o,this.marginTop=o,this.marginLeft=a,this.marginRight=a}},{key:"copyFrom",value:function(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.marginBottom=t.marginBottom,this.marginTop=t.marginTop,this.marginLeft=t.marginLeft,this.marginRight=t.marginRight}}]),t}(),g=e(3);function l(t,i){var e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"blue",o=!1;return e||o?a.a.createElement("rect",{className:i+"__border",transform:"translate("+t.marginLeft+","+t.marginTop+")",width:t.width,height:t.height,stroke:n,strokeWidth:"0.4",fill:"none"}):a.a.createElement(a.a.Fragment,null)}function u(t,i){var e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"gray";return e?a.a.createElement("rect",{className:i+"__outer-border",transform:"translate(0,0)",width:t.width+t.marginLeft+t.marginRight,height:t.height+t.marginTop+t.marginBottom,stroke:n,strokeWidth:"0.4",fill:"none"}):a.a.createElement(a.a.Fragment,null)}var p=function(){function t(){Object(r.a)(this,t),this.fun=void 0,this.l=[],document.addEventListener("keydown",(function(t){console.log(t)}))}return Object(h.a)(t,[{key:"select",value:function(t){this.clear(),this.l.push(t),t.setSelect(!0)}},{key:"clear",value:function(){this.l.forEach((function(t){t.setSelect(!1)})),this.l.length=0}}],[{key:"getInstance",value:function(){return this.instance||(this.instance=new t),this.instance}}]),t}();p.instance=void 0;var v=p,w=function(){function t(i,e){Object(r.a)(this,t),this.config=void 0,this.n="",this.noteGroup=[],this.l=0,this.p=0,this.dx=0,this.notesY=[],this.pointsY=[],this.tailPointsX=[],this.dimens=new f,this.config=e,void 0!==i.n&&(this.n=i.n,this.generateGroup(),this.l=i.l,this.p=i.p),void 0!==i.dimens&&(this.dimens=i.dimens)}return Object(h.a)(t,[{key:"settle",value:function(){var t=this,i=this.dx+this.config.noteWidth+this.p*this.config.tailPointGap,e=0,n=0;n+=this.l*this.config.pointGap;var a=0;this.noteGroup.forEach((function(i,o){if(i.t<0){if(0===o)for(var s=-i.t;s>0;--s){var r=t.config.pointGap;n+=r/2,t.pointsY.push(-n),n+=r/2}if(0!==o)for(var h=-i.t;h>0;--h){var m=t.config.pointGap;a+=m/2,t.pointsY.push(a),a+=m/2,e+=m}}t.notesY.push(e);var c=t.config.noteHeight;if(e+=c,a+=c,i.t>0)for(var d=i.t;d>0;--d){var f=t.config.pointGap;a+=f/2,t.pointsY.push(a),a+=f/2,e+=f}}));for(var o=0;o<this.p;++o)this.tailPointsX.push(this.dx+this.config.noteWidth+(o+.5)*this.config.tailPointGap);this.dimens.width=i,this.dimens.height=e,this.dimens.marginBottom=n}},{key:"generateGroup",value:function(){var t=this;this.n.split("|").forEach((function(i){for(var e=0;e<i.length;++e)if(i.charCodeAt(e)<=57&&i.charCodeAt(e)>=48||45===i.charCodeAt(e)){var n=i.substr(0,e),a=i.charAt(e),o=i.substr(e+1).length;0!==o&&"-"===i.charAt(e+1)&&(o=-o),t.noteGroup.push({x:n,n:a,t:o}),""!==n&&(t.dx=t.config.sigFontSize/2);break}}))}}]),t}();var E=function(t){var i=Object(n.useState)(!1),e=Object(g.a)(i,2),o=e[0],s=e[1],r=Object(n.useState)(t.note),h=Object(g.a)(r,2),m=h[0],c=h[1],d=t.note.dimens,f="muse-note";return a.a.createElement("g",{className:f,transform:"translate("+(d.x-d.marginLeft)+","+(d.y-d.marginTop)+")",width:d.width+d.marginLeft+d.marginRight,height:d.height+d.marginTop+d.marginBottom,onClick:function(){v.getInstance().select({isSelect:o,setSelect:s,note:m,setNote:c})}},u(d,f,o,"blue"),function(t,i){return a.a.createElement("g",{className:i+"__group-note"},t.noteGroup.map((function(e,n){return a.a.createElement("g",{className:i+"__note-one",key:n,width:t.dimens.width,height:t.notesY[n],transform:"translate(0,"+(t.dimens.height-t.notesY[n])+")"},a.a.createElement("text",{fontFamily:t.config.noteFontFamily,fontSize:t.config.noteFontSize,transform:"translate("+t.dx+",0)"},e.n),a.a.createElement("text",{fontFamily:t.config.noteFontFamily,fontSize:t.config.sigFontSize,transform:"translate(0,"+(t.config.sigFontSize-t.config.noteHeight)+")"},{S:"#",F:"b",DS:"x",DF:"d",N:"n"}[e.x]||""))})))}(t.note,f),function(t,i){return a.a.createElement("g",{className:i+"__group-point"},t.pointsY.map((function(i,e){return a.a.createElement("circle",{key:e,r:t.config.pointRound,fill:"black",transform:"translate("+(t.dx+t.config.noteWidth/2)+","+(t.dimens.height-i+t.config.pointGap/2)+")"})})))}(t.note,f),function(t,i){return a.a.createElement("g",{className:i+"__tail-point"},t.tailPointsX.map((function(i,e){return a.a.createElement("circle",{key:e,r:t.config.pointRound,fill:"black",transform:"translate("+i+","+(t.dimens.height-t.config.noteHeight/3)+")"})})))}(t.note,f))},y=function(){function t(i,e){var n=this;Object(r.a)(this,t),this.config=void 0,this.notes=[],this.dimens=new f,this.unitNum=0,this.notesX=[],this.baselineGroup=[],this.config=e,void 0!==i.notes&&(i.notes.forEach((function(t){n.notes.push(new w(t,n.config))})),this.generateBaseline(),this.notesX.push(1),this.notes.forEach((function(t,i){var e=0;void 0===n.notes[i+1]?e+=1:void 0!==n.notes[i+1]&&n.notes[i+1].l<t.l?e+=Math.pow(2,-n.notes[i+1].l):e+=Math.pow(2,-t.l);for(var a=1,o=1;o<=t.p;++o)a+=Math.pow(2,-o);e*=a,n.notesX.push(e),n.unitNum+=e}))),void 0!==i.dimens&&(this.dimens=i.dimens)}return Object(h.a)(t,[{key:"generateBaseline",value:function(){for(var t=this,i=function(i){var e=0,n=0,a=-1;if(t.notes.forEach((function(o,s){o.l>i?(a=s,e++):(n<=a&&t.baselineGroup.push({y:i,s:n,e:a}),n=s+1,a=s)})),n<=a&&t.baselineGroup.push({y:i,s:n,e:a}),0===e)return"break"},e=0;;++e){if("break"===i(e))break}}}]),t}();var b=function(t){var i=t.bar.dimens,e="muse-bar";return a.a.createElement("g",{className:e,transform:"translate("+(i.x-i.marginLeft)+","+(i.y-i.marginTop)+")",width:i.width+i.marginLeft+i.marginRight,height:i.height+i.marginTop+i.marginBottom},l(i,e),function(t,i){return a.a.createElement("line",{className:i+"__bar-line",x1:t.marginLeft+t.width+t.marginRight,y1:0,x2:t.marginLeft+t.width+t.marginRight,y2:t.height,strokeWidth:1,stroke:"black"})}(i,e),function(t,i){return a.a.createElement("g",{className:i+"__base-line"},t.baselineGroup.map((function(i,e){return a.a.createElement("line",{key:e,x1:t.notes[i.s].dimens.x,y1:t.notes[i.s].dimens.height+(i.y+1)*t.config.pointGap,x2:t.notes[i.e].dimens.x+t.notes[i.e].dimens.width,y2:t.notes[i.s].dimens.height+(i.y+1)*t.config.pointGap,stroke:"black",strokeWidth:1})})))}(t.bar,e),t.bar.notes.map((function(t,i){return a.a.createElement(E,{note:t,key:i})})))},x=function t(i,e){var n=this;Object(r.a)(this,t),this.config=void 0,this.bars=[],this.dimens=new f,this.config=e,void 0!==i.bars&&i.bars.forEach((function(t){n.bars.push(new y(t,n.config))})),void 0!==i.dimens&&(this.dimens=i.dimens)};var k=function(t){var i=t.track.dimens;return a.a.createElement("g",{className:"muse-track",transform:"translate("+(i.x-i.marginLeft)+","+(i.y-i.marginTop)+")",width:i.width+i.marginLeft+i.marginRight,height:i.height+i.marginTop+i.marginBottom},l(i,"muse-track"),t.track.bars.map((function(t,i){return a.a.createElement(b,{bar:t,key:i})})))},F=function t(i,e){var n=this;Object(r.a)(this,t),this.config=void 0,this.tracks=[],this.dimens=new f,this.config=e,void 0!==i.tracks&&i.tracks.forEach((function(t){n.tracks.push(new x(t,n.config))})),void 0!==i.dimens&&(this.dimens=i.dimens)};var S=function(t){var i=t.line.dimens;return a.a.createElement("g",{className:"muse-line",transform:"translate("+(i.x-i.marginLeft)+","+(i.y-i.marginTop)+")",width:i.width+i.marginLeft+i.marginRight,height:i.height+i.marginTop+i.marginBottom},l(i,"muse-line"),function(t,i){return a.a.createElement("g",{className:i+"__line-head"},a.a.createElement("line",{x1:0,y1:0,x2:0,y2:t.height,strokeWidth:1,stroke:"black"}))}(i,"muse-line"),t.line.tracks.map((function(t,i){return a.a.createElement(k,{track:t,key:i})})))},z=function t(i,e){var n=this;Object(r.a)(this,t),this.config=void 0,this.lines=[],this.dimens=new f,this.index=0,this.config=e,void 0!==i.lines&&i.lines.forEach((function(t){n.lines.push(new F(t,n.config))})),void 0!==i.dimens&&(this.dimens=i.dimens)};var G=function(t){var i=t.page.dimens,e="muse-page";return a.a.createElement("g",{className:e,transform:"translate("+(i.x-i.marginLeft)+","+(i.y-i.marginTop)+")",width:i.width+i.marginLeft+i.marginRight,height:i.height+i.marginTop+i.marginBottom},l(i,e),u(i,e,!0),function(t,i,e,n){return a.a.createElement("g",{className:e+"__page-index",transform:"translate("+(i.marginLeft+i.width/2)+","+(i.marginTop+i.height+i.marginBottom/2)+")"},a.a.createElement("text",{textAnchor:"middle",fontFamily:n.textFontFamily,fontSize:n.pageIndexFontSize},t.toString()))}(t.page.index,i,e,t.page.config),t.page.lines.map((function(t,i){return a.a.createElement(S,{line:t,key:i})})))},L=function t(i,e){var n=this;Object(r.a)(this,t),this.config=void 0,this.pages=[],this.title="",this.subtitle="",this.author=[],this.speed="",this.rhythmic="",this.C="",this.dimens=new f,this.config=e;var a=JSON.parse(i);void 0!==a.pages&&a.pages.forEach((function(t){n.pages.push(new z(t,n.config))})),void 0!==a.dimens&&(this.dimens=a.dimens),void 0!==a.title&&(this.title=a.title),void 0!==a.subtitle&&(this.subtitle=a.subtitle),void 0!==a.author&&(this.author=a.author.toString().split("|")),void 0!==a.speed&&(this.speed=a.speed),a.rhythmic&&(this.rhythmic=a.rhythmic),a.C&&(this.C="1="+a.C)};var N=function(t){var i=t.notation.dimens,e="muse-notation";return a.a.createElement("svg",{className:"muse",width:t.notation.dimens.width+20,height:t.notation.dimens.height+20},a.a.createElement("g",{className:e,transform:"translate(10,10)",width:t.notation.dimens.width,height:t.notation.dimens.height},l(i,e),function(t,i){var e=t.config,n=0;n+=e.pageMarginVertical;var o=a.a.createElement("text",{className:i+"__info-title",fontFamily:e.textFontFamily,width:t.dimens.width,textAnchor:"middle",fontSize:e.infoTitleFontSize,transform:"translate("+(t.dimens.marginLeft+t.dimens.width/2)+","+n+")"},t.title);n+=e.infoTitleFontSize+e.infoGap;var s=a.a.createElement("text",{className:i+"__info-subtitle",fontFamily:e.textFontFamily,width:t.dimens.width,textAnchor:"middle",fontSize:e.infoSubtitleFontSize,transform:"translate("+(t.dimens.marginLeft+t.dimens.width/2)+","+n+")"},t.subtitle),r=n,h=t.author.length,m=a.a.createElement("g",{className:i+"__info-author"},t.author.map((function(i,o){return r+=e.infoFontSize+e.infoGap,o<h-2&&(n+=e.infoFontSize+e.infoGap),a.a.createElement("text",{key:o,fontFamily:e.textFontFamily,width:t.dimens.width,fontSize:e.infoFontSize,textAnchor:"end",x:0,transform:"translate("+(t.dimens.width-e.pageMarginHorizontal)+","+r+")"},i)}))),c=n+(e.infoGap+e.infoSubtitleFontSize),d=c+(e.infoGap+e.infoFontSize),f=a.a.createElement("g",{className:i+"__info-rythmic",width:t.dimens.width},a.a.createElement("text",{fontFamily:e.textFontFamily,width:t.dimens.width,fontSize:e.infoFontSize,transform:"translate("+e.pageMarginHorizontal+","+c+")"},t.speed),a.a.createElement("text",{fontFamily:e.textFontFamily,width:t.dimens.width,fontSize:e.infoFontSize,transform:"translate("+e.pageMarginHorizontal+","+d+")"},t.C+" "+t.rhythmic));return a.a.createElement("g",{className:i+"__info",width:t.dimens.width},o,s,m,f)}(t.notation,e),t.notation.pages.map((function(t,i){return a.a.createElement(G,{page:t,key:i})}))))};function _(t,i){var e=i.pageMarginHorizontal,n=i.pageMarginVertical,a=i.notationWidth-2*e,o=i.notationWidth*i.pageE-2*n,s=new L(t,i),r=0;return s.pages.forEach((function(t,h){if(t.dimens.x=e,t.dimens.y=n*(h+1)+(n+o)*h,t.dimens.width=a,t.dimens.marginLeft=e,t.dimens.marginRight=e,t.dimens.height=o,t.dimens.marginTop=n,t.dimens.marginBottom=n,0===h){var m=0;m+=i.infoTitleFontSize+i.infoGap,m+=i.infoSubtitleFontSize+i.infoGap,m+=s.author.length*(i.infoFontSize+i.infoGap),t.dimens.marginTop+=m,t.dimens.height-=m,t.dimens.y+=m}t.index=h+1,r+=t.dimens.marginTop+t.dimens.marginBottom+t.dimens.height;var c=[],d=t.dimens.height;t.lines.forEach((function(e){e.dimens.width=t.dimens.width,e.dimens.x=t.dimens.marginLeft;var n=0,a=0,o=[];e.tracks.forEach((function(t){t.bars.forEach((function(t,i){void 0!==o[i]?o[i]=o[i]>t.unitNum?o[i]:t.unitNum:o.push(t.unitNum)}))}));var s=o.reduce((function(t,i){return t+i}));e.tracks.forEach((function(t){var r;t.dimens.y=a,t.dimens.width=e.dimens.width;var h=0,m=0,c=0;t.bars.forEach((function(e,n){e.unitNum=o[n],e.dimens.width=o[n]/s*t.dimens.width,e.dimens.x=c,c+=e.dimens.width;var a=[];e.notes.forEach((function(t){t.settle();var i=t.dimens.width,e=t.dimens.height,n=t.dimens.marginBottom;h=h>e?h:e,m=m>n?m:n,a.push(i)}));var r=0;e.notes.forEach((function(t,n){r+=e.notesX[n]/(e.unitNum+1)*e.dimens.width,t.dimens.x=r-i.noteWidth/2-t.dx}))})),t.dimens.height=h+m,t.bars.forEach((function(i){i.dimens.height=t.dimens.height,i.notes.forEach((function(t){t.dimens.height=h,t.dimens.marginBottom=m}))})),n+=(r=h+m)+i.trackGap,a+=r+i.trackGap})),n-=i.trackGap,e.dimens.height=n,d-=n,c.push(n)}));var f=d/(t.lines.length-1);t.lines.forEach((function(i,e){for(var n=t.dimens.marginTop,a=0;a<e;++a)n+=f+c[a];i.dimens.y=n}))})),s.dimens.width=a+2*e,s.dimens.height=r,s}var B=function(t){return a.a.createElement(N,{notation:_(t.data,t.config?t.config:new d)})},T=function(t){Object(m.a)(e,t);var i=Object(c.a)(e);function e(t){var n;return Object(r.a)(this,e),(n=i.call(this,t)).state={errorA:null,errorB:null,isLoadedA:!1,isLoadedB:!1,a:"",b:""},n}return Object(h.a)(e,[{key:"componentDidMount",value:function(){var t=this,i="https://cdn.jsdelivr.net/gh/shizuku/muse-react/test/data/";fetch(i+"a.json").then((function(t){return t.text()})).then((function(i){t.setState({isLoadedA:!0,a:i})}),(function(i){t.setState({isLoadedA:!0,errorA:i})})),fetch(i+"b.json").then((function(t){return t.text()})).then((function(i){t.setState({isLoadedB:!0,b:i})}),(function(i){t.setState({isLoadedB:!0,errorB:i})}))}},{key:"render",value:function(){return a.a.createElement("div",{className:"app"},a.a.createElement("h2",null,"Example A"),this.state.isLoadedA?this.state.errorA?"error":a.a.createElement(B,{data:this.state.a}):"loading...",a.a.createElement("h2",null,"Example B"),this.state.isLoadedB?this.state.errorB?"error":a.a.createElement(B,{data:this.state.b}):"loading...")}}]),e}(a.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(T,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))},8:function(t,i,e){t.exports=e(15)}},[[8,1,2]]]);
//# sourceMappingURL=main.db5c607b.chunk.js.map